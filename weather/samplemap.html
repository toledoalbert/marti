<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Marti Twitter Weathermap</title>
    
    <meta name="author" content="Marti">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- favicon -->
    <!-- <link rel="icon" type="image/png" href="C:\Users\JaMerra\Desktop\map\apple-touch-icon.png"> -->

<!-- Le styles -->
    <link href="/marti/weather/font-awesome.css" rel='stylesheet' 
type="text/css" media="all">
    <link href="//fonts.googleapis.com/css?family=Cabin" rel='stylesheet' 
type='text/css'>
    <link href="//fonts.googleapis.com/css?family=PT+Sans" rel='stylesheet' 
type="text/css" media="all">
    <link href='//fonts.googleapis.com/css?family=Raleway:200,400,500,600700' 
rel='stylesheet' type='text/css'>
    <link href="/marti/weather/bootstrap.min.css" 
rel="stylesheet">
    <link href="/marti/weather/bootstrap-responsive.min.css" 
rel="stylesheet">
    <link href="/marti/weather/stylebody.css" rel="stylesheet" 
type="text/css" media="all">
    <link href="/font-awesome-4.2.0" rel="stylesheet" 
type="text/css" media="all">    
<link href="style/icons.css" rel="stylesheet" 
type="text/css" media="all">






    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="apple-touch-icon.png" type ="image/png" />
    <link rel="apple-touch-icon" href="images/png">
    <link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png">
    <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
  -->

    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35402310-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>

<div class="container">
  <div style="margin-bottom: 50px;">
    <div class="page-header">
	<img src = "apple-touch-icon.png" height= "25%" width= "25%">
      <h1 style="text-decoration:none; color: #004C99;font size: 150 px;text-align: center;">Marti WeatherMap</a></h1> 

    </div>

<a href="https://twitter.com/intent/tweet?button_hashtag=weather" class="twitter-hashtag-button" data-size="large" data-related="getOutMyMerra">Tweet #weather</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  </head>

  <body>
    

        

<link href="./tipsy.css" rel="stylesheet" type="text/css" />
<link href="./style.css" rel="stylesheet" type="text/css" />
<style>
  path {
    fill: #004C99;
    stroke: #0080FF;
  }
</style>
<section style="background-color: #0080FF; width: 100%; padding-top: 50px; padding-bottom: 50px; border-top: 2px solid #000066; border-bottom: 2px solid #000066;">
  <div> 
    <h2 style="color: #FFFFFF; text-align: center; margin-bottom: 20px; font-weight: 200;">• Weather Displayed for state capitals •</h2>
    <svg id="chart" style="display:block; text-align:center; margin: 0 auto;" width="960" height="500" viewBox="0 0 960 500" preserveAspectRatio="xMidYMid"></svg>
  </div>
</section>



<script src="./jquery.js"></script>
<script src="./d3.v2.min.js"></script>
<script src="./jquery.tipsy.js"></script>
<script type="text/javascript">


  // Add responsivity to SVG and D3 chart
  var aspect = 960 / 500,
  chart = $("#chart");
  var targetWidth = chart.parent().width();
  chart.attr("width", targetWidth);
  chart.attr("height", targetWidth / aspect);
  $(window).on("resize", function() {
    var targetWidth = chart.parent().width();
    chart.attr("width", targetWidth);
    chart.attr("height", targetWidth / aspect);
  });
  
  $(document).ready(function() {
  // Generate continental US plot
  var map = d3.select("svg");
  var projection = d3.geo.albers()
  var path = d3.geo.path().projection(projection);
  d3.json('us-states.json', function(collection) {
      map.selectAll('path')
        .data(collection.features)
        .enter().append('path').attr('d', path);
      // Now use the projection to project your coords
  });

  function mapCity(locationData) {
    
      var tipText; 
      var coordinates = projection([locationData.coordinates[1], locationData.coordinates[0]]);


      $.getJSON('http://api.openweathermap.org/data/2.5/weather?lat=' + locationData.coordinates[0] + '&lon=' + locationData.coordinates[1] + '&units=imperial&callback=?', function(data) {
        tipText = "<h2 style='color: #FFF; font-weight: 100;'>" + locationData.city + "</h2><h4 style='color: #FFF; font-weight: 100;'>" + data.weather[0].description.toString().toLowerCase() + "</h4><h3 style='font-size: 80px; font-family: Helvetica Neue, Segoe UI Light, Arial; font-weight: 100; color: #FFF; line-height: 80px;'>" + data.main.temp.toString().split('.')[0] + "°F</h3>";
        addWeather(coordinates, tipText, locationData.city, data)
      });

  };

  function addWeather(coordinates, tipText, city, data) {
      var suggested = data.weather[0].icon;
      console.log(city + data.weather[0].icon);
      var icon

      // This is ugly, but I'm lazy
      if(suggested == "01d") {
        icon = "img/sunny.svg";
      }else if(suggested == "01n") {
        icon = "img/moon.svg";
      }else if(suggested == "02d" || suggested == "03d" || suggested == "04d") {
        icon = "img/cloud.svg";
      }else if(suggested == "02n" || suggested == "03n" || suggested == "04n") {
        icon = "img/cloud.svg";
      }else if(suggested == "09d" || suggested == "09n" || suggested == "50d" || suggested == "50n") {
        icon = "img/rain.svg";
      }else if(suggested == "10d" || suggested == "10n") {
        icon = "img/rain.svg";
      }else if(suggested == "11d" || suggested == "11n") {
        icon = "img/lightning.svg";
      }else if(suggested == "13d" || suggested == "13n") {
        icon = "img/snow.svg";
      }
4325  
      var imgs = map.selectAll("body").data(coordinates);
          imgs.enter()
          .append("svg:image")
          .attr("xlink:href", '' + icon)
          .attr("x", coordinates[0] - 13)
          .attr("y", coordinates[1] - 13)
          .attr("width", "20px")
          .attr("height", "20px")

      // This is a hack for the toolips because hover of the svg icons isn't working
      map.append('svg:rect')
          .attr("class", "Rects")
          // add an id such that each circle is mapped to a number, remove earliest circles once 10 exist on screen
          .attr("id", city)
          .attr('width', 20)
          .attr('height', 20)
          .style("stroke", "rgba(48,196,201,0)")
          .style("stroke-width", 1)
          .style("fill", "rgba(48,196,201,0)")
          .attr('x', coordinates[0] - 13)
          .attr('y', coordinates[1] - 13)


      addTipsy(tipText, city);
  };


  // Add tipsy tooltip
  function addTipsy(tipText, city) {
    $('#' + city).tipsy({
      gravity: 'w',
      fade: true,
      html: true,
      opacity: 1,
      title: function() {
        return tipText;
      }
    });
  }

  // Ensure cities only fire once
  var fired = 0;

  // Map cities based on scroll position
  $(window).scroll(function() { 
    if($('#chart').offset().top - $(window).scrollTop() < 160 && fired < 1) {
      mapCity({
        coordinates: ['33.74718','-84.389817'],
        city: 'atlanta'
      });
      mapCity({
        coordinates: ['42.651445','-73.755254'],
        city: 'albany'
      });
      mapCity({
        coordinates: ['35.785510','-78.642669'],
        city: 'raleigh'
      });
      mapCity({
        coordinates: ['46.805372','-100.779334'],
        city: 'bismark'
      });
      mapCity({
        coordinates: ['38.8044','-77.012208'],
        city: 'dc'
      });
      mapCity({
        coordinates: ['32.380120','-86.300629'],
        city: 'montgomery'
      });
      mapCity({
        coordinates: ['58.299740','-134.406794'],
        city: 'juneau'
      });
     mapCity({
        coordinates: ['33.448260','-112.075774'],
        city: 'phoenix'
      });
     mapCity({
        coordinates: ['34.748655','-92.274494'],
        city: 'little rock'
      });
     mapCity({
        coordinates: ['38.579065','-121.491014'],
        city: 'sacramento'
      });     mapCity({
        coordinates: ['39.740010','-104.992259'],
        city: 'denver'
      });     mapCity({
        coordinates: ['41.763325','-72.674069'],
        city: 'hartford'
      });     mapCity({
        coordinates: ['39.158035','-75.524734'],
        city: 'dover'
      });     mapCity({
        coordinates: ['30.439775','-84.280649'],
        city: 'tallahassee'
      });     mapCity({
        coordinates: ['21.304770','-157.857614'],
        city: 'honolulu'
      });     mapCity({
        coordinates: ['43.606980','-116.193409'],
        city: 'boise'
      });     mapCity({
        coordinates: ['39.801055','-89.643604'],
        city: 'springfield'
      });     mapCity({
        coordinates: ['39.766910','-86.149964'],
        city: 'indianapolis'
      });     mapCity({
        coordinates: ['41.589790','-93.615659'],
        city: 'des moines'
      });     mapCity({
        coordinates: ['39.049285','-95.671184'],
        city: 'topeka'
      });     
	mapCity({
        coordinates: ['38.195070','-84.878694'],
        city: 'frankfort'
      });    
	mapCity({
        coordinates: ['30.443345','-91.186994'],
        city: 'baton rouge'
      });      
	mapCity({
        coordinates: ['44.318036','-69.776218'],
        city: 'augusta'
      });     mapCity({
        coordinates: ['38.976700','-76.489934'],
        city: 'annapolis'
      });     mapCity({
        coordinates: ['42.358635','-71.056699'],
        city: 'boston'
      });     mapCity({
        coordinates: ['42.731940','-84.552249'],
        city: 'lansing'
      });     mapCity({
        coordinates: ['44.943829','-93.093326'],
        city: 'saint paul'
      });     mapCity({
        coordinates: ['32.298690','-90.180489'],
        city: 'jackson'
      });     mapCity({
        coordinates: ['38.577515','-92.177839'],
        city: 'jefferson city'
      });     mapCity({
        coordinates: ['46.589760','-112.021202'],
        city: 'helana'
      });     mapCity({
        coordinates: ['40.813620','-96.707739'],
        city: 'lincoln'
      });     mapCity({
        coordinates: ['39.164885','-119.766999'],
        city: 'carson city'
      });     mapCity({
        coordinates: ['43.207250','-71.536604'],
        city: 'concord'
      });     mapCity({
        coordinates: ['40.217875','-74.759404'],
        city: 'trenton'
      });     mapCity({
        coordinates: ['35.691543','-105.937406'],
        city: 'santa fe'
      });
      mapCity({
        coordinates: ['39.961960','-83.002984'],
        city: 'columbus'
      });     
	 mapCity({
        coordinates: ['35.472015','-97.520354'],
        city: 'oklahoma'
      });
      mapCity({
        coordinates: ['44.933260','-123.043814'],
        city: 'salem'
      });
      mapCity({
        coordinates: ['40.259865','-76.882230'],
        city: 'harrisburg'
      });
      mapCity({
        coordinates: ['41.823875','-71.411994'],
        city: 'providence'
      });
      mapCity({
        coordinates: ['33.998550','-81.045249'],
        city: 'columbia'
      });
      mapCity({
        coordinates: ['44.368924','-100.350158'],
        city: 'pierre'
      });
      mapCity({
        coordinates: ['36.167783','-86.778365'],
        city: 'nashville'
      });
      mapCity({
        coordinates: ['40.759505','-111.888229'],
        city: 'salt lake city'
      });
      mapCity({
        coordinates: ['30.267605','-97.742984'],
        city: 'austin'
      });
      mapCity({
        coordinates: ['44.260299','-72.576264'],
        city: 'montpelier'
      });
      mapCity({
        coordinates: ['37.540700','-77.433654'],
        city: 'richmond'
      });
     mapCity({
        coordinates: ['47.039231','-122.891366'],
        city: 'olympia'
      });
     mapCity({
        coordinates: ['38.350195','-81.638989'],
        city: 'charleston'
      });
     mapCity({
        coordinates: ['43.072950','-89.386694'],
        city: 'madison'
      });
     mapCity({
        coordinates: ['41.134815','-104.821544'],
        city: 'cheyenne'
      });
      fired++;
    }
  });
  });
</script>

  </body>
</html>

